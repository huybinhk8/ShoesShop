USE master;
GO


IF  EXISTS (SELECT name FROM sys.databases WHERE name = N'shoesshop')
BEGIN 
	ALTER DATABASE shoesshop SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
	DROP DATABASE shoesshop;
END
GO

create database shoesshop;
go

use shoesshop;
go

--TẠO BẢNG
CREATE TABLE HANG(
	MAHANG VARCHAR(10) PRIMARY KEY,
	TENHANG NVARCHAR(30) NOT NULL
);
GO

CREATE TABLE SANPHAM(
	MASP VARCHAR(10) PRIMARY KEY,
	TENSP NVARCHAR(50) NOT NULL,
	MAHANG VARCHAR(10),
	PHAI INT NOT NULL,
	HINH NVARCHAR(100),
	SOLUONG INT NOT NULL,
	DONGIA REAL NOT NULL,
	NGAYNHAP DATE NOT NULL
);
GO

CREATE TABLE NGUOIDUNG(
	MAND INT IDENTITY(1,1) PRIMARY KEY,
	TENND NVARCHAR(50) NOT NULL,
	PHAI INT NOT NULL,
	NGAYSINH DATE,
	TENTK VARCHAR(100) NOT NULL,
	MATKHAU NVARCHAR(32) NOT NULL,
	CHUCVU INT NOT NULL
);
GO

CREATE TABLE DONHANG(
	MADH INT IDENTITY(1,1) PRIMARY KEY,
	MAND INT,
	NGAYDATHANG DATE NOT NULL,
	MASP VARCHAR(10),
	SOLUONGSP INT NOT NULL,
	TONGTIEN REAL NOT NULL,
	TINHTRANG INT NOT NULL
);
GO

--KHÓA NGOẠI
ALTER TABLE SANPHAM
ADD CONSTRAINT SP_HANG FOREIGN KEY (MAHANG) REFERENCES HANG (MAHANG)
go

ALTER TABLE DONHANG
ADD CONSTRAINT KH_NGUOIDUNG FOREIGN KEY (MAND) REFERENCES NGUOIDUNG (MAND)
go

ALTER TABLE DONHANG
ADD CONSTRAINT KH_SP FOREIGN KEY (MASP) REFERENCES SANPHAM (MASP)
go

-- view 
CREATE VIEW v_thongtingnuoidung AS
	SELECT u.MAND,u.TENND,u.PHAI,u.NGAYSINH,u.TENTK,u.CHUCVU FROM NGUOIDUNG u;
go

-- procedure
--thủ tục đăng ký tài khoản
CREATE PROCEDURE p_dangky (@tenND NVARCHAR(50), 
						   @phai INT, 
						   @ngaySinh DATE, 
						   @tenTK VARCHAR(100), 
						   @matKhau VARCHAR(32))
as
begin
	insert into NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(@tenND, @phai, @ngaySinh, @tenTK, @matKhau, 0);
end;
go

CREATE PROCEDURE p_thongtinnguoidung (@username VARCHAR(100))
AS 
	SELECT * FROM v_thongtingnuoidung v WHERE v.TENTK = @username;
go

INSERT INTO NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(N'Admin', 0,null,'admin', '123456', 1);
INSERT INTO NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(N'Trần Thị Thùy Dương', 1, '1997-05-01', 'tranduong', '789654', 0);
INSERT INTO NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(N'Trần Thị Phương Trà', 1, '1996-12-02', 'tranho', 'ngoybi',0);
INSERT INTO NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(N'Trần Đức Thắng', 0, '1996-01-23', 'thangvien', '159632',0);
INSERT INTO NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(N'Trần Anh Dũng', 0, NULL, 'dungtran', '789456123',0);
INSERT INTO NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(N'Hồ sỹ huy', 0, '1995-12-22', 'huybinhk89216', 'huytra9212',0);
INSERT INTO NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(N'Nguyễn Đức Huy', 0, '1999-09-02', 'abc', '456789',0);
INSERT INTO NGUOIDUNG(TENND,PHAI,NGAYSINH,TENTK,MATKHAU,CHUCVU) VALUES(N'Nguyễn Thị Thy', 1, '1998-05-06', 'ksdc', '159789',0);


INSERT INTO HANG (MAHANG, TENHANG) VALUES('AD03', N'ADIDAS');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('BN11', N'BANULI');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('CV01', N'CONVERSE');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('DC09', N'DC');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('GC014', N'GUCCI');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('JB013', N'JAMES BLANC');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('JD04', N'JORDAN');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('LV016', N'LOUIS VUITTON');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('N02', N'NIKE');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('NB10', N'NEW BALANCE');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('PM08', N'PUMA');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('RB05', N'REEBOK');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('SVD12', N'SANVADO');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('UA07', N'UNDER ARMOUR');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('V06', N'VANS');
INSERT INTO HANG (MAHANG, TENHANG) VALUES('VS015', N'VERSACE');

INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('001', N'Converse chucks taylor xanh dương cao cổ', 'CV01', 0, N'giay-converse-chuck-taylor-2-mau-xanh-duong-cao-co.jpg', 20, 285000, '2017-08-09');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('002', N'Converse thấp cổ vải đen viền 1970 đen CV-TMD-031', 'CV01', 1, N'img-8467.jpg', 30, 800000, '2017-09-08');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('003', N'Nike air max sequent', 'N02', 1, '44-800x800.jpg', 15, 1650000, '2017-07-26');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('004', N'Jordan SC3-BG all black', 'JD04', 0, N'Q3835jordanshoes_12990.jpg', 15, 1800000, '2017-08-05');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('005', N'Adidas Tubular Doom sock', 'AD03', 0, N'ipad_e9f01c69ae07cffca5d07464e08c17fd59ade4442fc52.jpg', 15, 2400000, '2017-07-26');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('006', N'Puma by Rihanna', 'PM08', 1, N'fenty_x_puma_rihanna_wmns_bow_sneaker_36505401_puma_36505401.jpg', 20, 2000000, '2017-08-05');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('007', N'Under armour black/red', 'UA07', 0, N'Boys-Under-Armour-UA-SpeedForm-Phenom-High-Top-Black-Red-Shoes.jpg', 15, 1900000, '2017-09-02');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('008', N'Reebok Astroride', 'RB05', 1, N'3814454-p-MULTIVIEW.jpg', 15, 999000, '2017-09-12');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('009', N'Banuli captoe oxford (da bò - màu đỏ)', 'BN11', 0, N'giày tây nam cao c?p.jpg', 10, 1700000, '2017-09-09');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('010', N'Dc chính hãng', 'DC09', 0, N'20150820_b28b9a8c6fda7e60cb3c3e3b8287a56f_1440068967.jpg', 15, 800000, '2017-10-10');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('011', N'Giày lười công sở Sanvado da trơn màu đen (HM-271)', 'SVD12', 0, N'giay-cong-so-buoc-day-sanvado-da-tron-mau-den-ap-129_4.jpg', 20, 699000, '2017-10-12');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('012', N'Gucci-GTA29 (black)', 'GC014', 0, N'giay-hieu-gucci-gta29-black.jpg', 30, 5699000, '2017-10-12');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('013', N'Gucci- GT37', 'GC014', 0, N'giay-nam-cao-cap-gucci-gt37-3.jpg', 20, 5890000, '2017-10-10');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('014', N'Louis vuitton - ND0147', 'LV016', 0, N'2442971img_0085__copy.jpg', 20, 2500000, '2017-10-03');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('015', N'New balance 996 cổ cao đỏ/trắng', 'NB10', 1, N'02_2048x.jpg', 30, 1272000, '2017-09-08');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('016', N'Vans sneaker đen trắng', 'V06', 1, N'vn0d3hy28.jpg', 30, 380000, '2017-09-08');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('017', N'Vans oldskool black', 'V06', 1, N'vans-old-skool-suede-black-black-black.jpg', 30, 490000, '2017-09-02');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('018', N'Adidas nữ original ZX flux adv smooth', 'AD03', 1, N'2de7894250d3882bb06c4afcbbf3b0ea.jpg', 20, 1830000, '2017-09-20');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('019', N'Adidas original superstar', 'AD03', 1, N'bb2230-2.jpg', 25, 1830000, '2017-09-20');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('020', N'Converse chuck taylor modern engineered leather', 'CV01', 0, N'557942standard.jpg', 35, 2700000, '2017-10-10');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('021', N'Converse chuck taylor all star iridescent leather', 'CV01', 1, N'converse-chuck-taylor-all-star-brea-iridescent-leather-white_o5alj5.jpg', 35, 1700000, '2017-10-10');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('022', N'Vans SK8-HI đen trắng', 'V06', 0, N'd5ib8c-hero.jpg', 25, 1439000, '2017-09-06');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('023', N'James blanc JB-008', 'JB013', 0, N'giay-cong-so-buoc-day-james-blanc-da-tron-mau-nau-jb-008 (1).jpg', 10, 1530000, '2017-09-05');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('024', N'Reebok AR2395 les mills cardio ultra 3.0', 'RB05', 1, N'20160824114644_6cc57e10.jpg', 20, 2799000, '2017-09-20');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('025', N'Reebok BD4791 trainfusion nine2.0', 'RB05', 0, N'Reebok BD4791 trainfusion nine2.0.jpg', 10, 1289000, '2017-09-20');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('026', N'Sneaker gucci lace-up cao cấp', 'GC014', 0, N'16253282553_c3d3e53b90.jpg', 15, 18300000, '2017-09-02');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('027', N'Jordan 11s - legend blue', 'JD04', 1, N'air-jordan-11-columbia-legend-blue-2.jpg', 15, 700000, '2017-09-08');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('028', N'Nike lunarepic low flyknit', 'N02', 0, N'maxresdefault.jpg', 20, 2340000, '2017-09-09');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('029', N'Adidas neo lite races', 'AD03', 0, N'lite-racer-6-adidas-neo-cblack-ftwwht-scarle-original-imaes9eah7f66hfu.jpg', 20, 1295000, '2017-09-09');
INSERT INTO SANPHAM(MASP, TENSP, MAHANG, PHAI, HINH, SOLUONG, DONGIA, NGAYNHAP) VALUES('030', N'Under armour bandit 2.0 dark blue', 'UA07', 0, N'Under Armour Charged Bandit 2 Blue Men Running Shoes Sk236957 - Men Under Armour Shoes 624_LRG.jpg', 20, 1900000, '2017-09-09');



INSERT INTO DONHANG (MAND, NGAYDATHANG, MASP,SOLUONGSP, TONGTIEN, TINHTRANG) VALUES(1, '2017-10-05','006',2,4000000, 0);
INSERT INTO DONHANG (MAND, NGAYDATHANG, MASP,SOLUONGSP, TONGTIEN, TINHTRANG) VALUES(2, '2017-07-29', '002',1, 800000, 1);
INSERT INTO DONHANG (MAND, NGAYDATHANG, MASP,SOLUONGSP, TONGTIEN, TINHTRANG) VALUES(3, '2017-05-30', '012', 1, 5600, 0);
INSERT INTO DONHANG (MAND, NGAYDATHANG, MASP,SOLUONGSP, TONGTIEN, TINHTRANG) VALUES(4, '2017-11-09', '030', 1, 1900000, 0);
INSERT INTO DONHANG (MAND, NGAYDATHANG, MASP,SOLUONGSP, TONGTIEN, TINHTRANG) VALUES(5, '2017-06-23', '028', 1, 2340000, 1);
INSERT INTO DONHANG (MAND, NGAYDATHANG, MASP,SOLUONGSP, TONGTIEN, TINHTRANG) VALUES(6, '2017-09-09', '014', 1, 2500000, 0);

select * from NGUOIDUNG;